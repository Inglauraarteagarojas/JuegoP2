<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tug of War: Arreglos & POO Java</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 10px;
    }

    .game-container {
      max-width: 1600px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px;
      text-align: center;
      flex-shrink: 0;
    }

    .header h1 {
      font-size: 2em;
      margin-bottom: 5px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .game-board {
      display: grid;
      grid-template-columns: 1fr 420px 1fr;
      gap: 0;
      flex: 1;
      overflow: hidden;
    }

    .player-panel {
      display: flex;
      flex-direction: column;
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border-right: 3px solid #667eea;
      overflow-y: auto;
      padding: 20px;
    }

    .player-panel.p2 {
      background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%);
      border-right: none;
      border-left: 3px solid #667eea;
    }

    .player-header {
      text-align: center;
      margin-bottom: 15px;
      font-weight: bold;
      font-size: 1.3em;
    }

    .player-header.p1 { color: #1976d2; }
    .player-header.p2 { color: #c2185b; }

    .score-display {
      background: white;
      padding: 12px;
      border-radius: 50px;
      text-align: center;
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 15px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    .score-display.p1 { color: #1976d2; }
    .score-display.p2 { color: #c2185b; }

    .question-box {
      background: white;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 15px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      flex-shrink: 0;
    }

    .question-title {
      font-size: 0.85em;
      color: #666;
      margin-bottom: 8px;
      font-weight: bold;
    }

    .question-text {
      font-size: 1.1em;
      color: #333;
      margin-bottom: 12px;
      line-height: 1.4;
    }

    .code-block {
      background: #f5f5f5;
      border-left: 4px solid #667eea;
      padding: 10px;
      margin: 10px 0;
      font-family: 'Courier New', monospace;
      font-size: 0.85em;
      border-radius: 5px;
      overflow-x: auto;
      line-height: 1.5;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .option-btn {
      padding: 12px;
      background: #f8f9fa;
      border: 2px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95em;
      transition: all 0.3s ease;
      text-align: left;
      font-weight: 500;
    }

    .option-btn:hover {
      background: #e8e8ff;
      border-color: #667eea;
      transform: translateX(5px);
    }

    .option-btn:disabled { cursor: not-allowed; opacity: 0.6; }

    .feedback {
      margin-top: 10px;
      padding: 10px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.9em;
      display: none;
    }

    .feedback.show { display: block; }
    .feedback.correct {
      background: #d4edda; color: #155724; border: 2px solid #28a745;
    }
    .feedback.incorrect {
      background: #f8d7da; color: #721c24; border: 2px solid #f5c6cb;
    }

    .correct-answer {
      margin-top: 8px;
      padding: 8px;
      background: rgba(255,255,255,0.4);
      border-radius: 5px;
      font-size: 0.85em;
    }

    .rope-center {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(180deg, #e3f2fd 0%, #fff 50%, #fce4ec 100%);
      padding: 20px;
      gap: 18px;
      position: relative;
    }

    .score-info {
      width: 100%;
      background: white;
      padding: 14px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      font-weight: bold;
      font-size: 1.05em;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .score-info span {
      padding: 6px 14px;
      border-radius: 50px;
      background: #f0f0f0;
      white-space: nowrap;
    }

    .score-info .p1-score { background: #e3f2fd; color: #1976d2; }
    .score-info .p2-score { background: #fce4ec; color: #c2185b; }

    .race-title {
      font-weight: 800;
      color: #4b4b4b;
      letter-spacing: 0.2px;
      text-align: center;
    }

    .race-subtitle {
      font-size: 0.95em;
      color: #666;
      text-align: center;
      margin-top: -8px;
    }

    .track {
      width: 100%;
      max-width: 380px;
      height: 260px;
      border-radius: 18px;
      background: linear-gradient(180deg, #9be7ff 0%, #d7ffda 100%);
      box-shadow: 0 6px 22px rgba(0,0,0,0.14);
      position: relative;
      overflow: hidden;
      border: 2px solid rgba(102,126,234,0.25);
    }

    .platform {
      position: absolute;
      left: 50%;
      top: 52%;
      transform: translate(-50%, -50%);
      width: 86%;
      height: 92px;
      border-radius: 16px;
      background: linear-gradient(180deg, #62d26f 0%, #30b050 100%);
      box-shadow: inset 0 0 0 6px rgba(255,255,255,0.25);
    }

    .lane-line {
      position: absolute;
      top: 50%;
      left: 7%;
      right: 7%;
      height: 4px;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.55);
      border-radius: 10px;
    }

    .start-line, .finish-line {
      position: absolute;
      top: 52%;
      transform: translateY(-50%);
      width: 10px;
      height: 74px;
      border-radius: 8px;
      background: rgba(255,255,255,0.8);
    }

    .start-line { left: 8%; }
    .finish-line {
      right: 8%;
      width: 22px;
      background:
        linear-gradient(90deg,
          #fff 0 25%, #ff4d4d 25% 50%,
          #fff 50% 75%, #ff4d4d 75% 100%);
      box-shadow: 0 0 0 2px rgba(255,255,255,0.6);
    }

    .step-dots {
      position: absolute;
      top: 52%;
      left: 10%;
      right: 10%;
      height: 0;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
    }

    .step-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255,255,255,0.6);
      transform: translateY(-40px);
    }

    .runner {
      position: absolute;
      top: 52%;
      transform: translate(-50%, -50%);
      width: 64px;
      height: 64px;
      border-radius: 18px;
      display: grid;
      place-items: center;
      font-size: 34px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.18);
      transition: left 0.45s ease;
      user-select: none;
    }

    .runner.p1 {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border: 2px solid rgba(25,118,210,0.25);
      top: calc(52% - 24px);
    }

    .runner.p2 {
      background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%);
      border: 2px solid rgba(194,24,91,0.25);
      top: calc(52% + 24px);
    }

    .runner.jump {
      animation: jump 0.45s ease;
    }

    @keyframes jump {
      0%   { transform: translate(-50%, -50%) scale(1); }
      50%  { transform: translate(-50%, -78%) scale(1.06); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    .progress-card {
      width: 100%;
      max-width: 380px;
      background: white;
      padding: 12px 14px;
      border-radius: 15px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      gap: 10px;
      font-weight: 700;
      color: #444;
    }

    .pill {
      padding: 6px 12px;
      border-radius: 999px;
      background: #f2f2f2;
      font-size: 0.95em;
      white-space: nowrap;
    }

    .pill.p1 { background: #e3f2fd; color: #1976d2; }
    .pill.p2 { background: #fce4ec; color: #c2185b; }

    .game-over {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .game-over-content {
      background: white;
      padding: 50px;
      border-radius: 25px;
      text-align: center;
      max-width: 600px;
      animation: slideIn 0.5s ease;
    }

    .end-emoji { font-size: 5em; margin-bottom: 20px; }
    .winner-text { font-size: 2.5em; margin-bottom: 20px; font-weight: bold; color: #667eea; }
    .final-score { font-size: 1.8em; margin: 20px 0; color: #333; }
    .end-message { font-size: 1.2em; color: #666; margin: 20px 0; }

    .btn-restart {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 16px 50px;
      border: none;
      border-radius: 12px;
      font-size: 1.2em;
      cursor: pointer;
      font-weight: 700;
      margin-top: 20px;
      transition: all 0.3s ease;
    }

    .btn-restart:hover {
      transform: scale(1.08);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    @keyframes slideIn {
      from { transform: scale(0.7); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #999; }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="header">
      <h1>üéÆ TUG OF WAR: ARREGLOS & POO JAVA üéÆ</h1>
      <p style="font-size: 0.9em; opacity: 0.9;">Arreglos 1D/2D ‚Ä¢ Constructores ‚Ä¢ Get/Set ‚Ä¢ new ‚Ä¢ Funciones de Valor</p>
    </div>

    <div class="game-board">
      <!-- PANEL JUGADOR 1 -->
      <div class="player-panel">
        <div class="player-header p1">üê∞ JUGADOR 1</div>
        <div class="score-display p1" id="score1">0 Puntos</div>
        <div id="content1"></div>
      </div>

      <!-- CENTRO - CARRERA -->
      <div class="rope-center">
        <div class="score-info">
          <span class="p1-score" id="p1-info">P1: 0</span>
          <span id="current-q">Ronda: 1/20</span>
          <span class="p2-score" id="p2-info">P2: 0</span>
        </div>

        <div class="race-title">üèÅ Carrera de Programaci√≥n Java</div>
        <div class="race-subtitle">‚úÖ Respuesta correcta = 1 salto ‚Ä¢ üèÅ 10 saltos para ganar</div>

        <div class="track" aria-label="pista de carrera">
          <div class="platform"></div>
          <div class="lane-line"></div>
          <div class="start-line" title="Salida"></div>
          <div class="finish-line" title="Meta"></div>
          <div class="step-dots" id="step-dots"></div>
          <div class="runner p1" id="runner1" title="Jugador 1">üßë‚Äçüíª</div>
          <div class="runner p2" id="runner2" title="Jugador 2">üßë‚Äçüíª</div>
        </div>

        <div class="progress-card">
          <div class="pill p1" id="p1-steps">P1 saltos: 0/10</div>
          <div class="pill" id="tie-info">Competencia en curso</div>
          <div class="pill p2" id="p2-steps">P2 saltos: 0/10</div>
        </div>
      </div>

      <!-- PANEL JUGADOR 2 -->
      <div class="player-panel p2">
        <div class="player-header p2">üê∞ JUGADOR 2</div>
        <div class="score-display p2" id="score2">0 Puntos</div>
        <div id="content2"></div>
      </div>
    </div>
  </div>

  <!-- MODAL FINAL -->
  <div class="game-over" id="gameOver">
    <div class="game-over-content">
      <div class="end-emoji" id="end-emoji">üèÜ</div>
      <div class="winner-text" id="winner-text"></div>
      <div class="final-score" id="final-score"></div>
      <div class="end-message" id="end-message"></div>
      <button class="btn-restart" onclick="location.reload()">üîÑ Jugar de Nuevo</button>
    </div>
  </div>

  <script>
    // 20 PREGUNTAS: Arreglos 1D/2D, Constructores con par√°metros, Get/Set, new, Funciones de valor
    const questions = [
      // ---- ARREGLOS UNIDIMENSIONALES ----
      {
        question: "¬øCu√°l es la sintaxis correcta para declarar e instanciar un arreglo unidimensional de 5 enteros en Java?",
        options: [
          "int arr[5];",
          "int[] arr = new int[5];",
          "int arr = new int(5);",
          "array int arr = 5;"
        ],
        correct: 1,
        explanation: "La sintaxis correcta es: int[] arr = new int[5]; Se usa 'new' para instanciar el arreglo con un tama√±o fijo."
      },
      {
        question: "¬øCu√°l es el √≠ndice del primer elemento de un arreglo en Java?",
        code: "int[] numeros = {10, 20, 30, 40, 50};",
        options: ["numeros[1]", "numeros[0]", "numeros.first()", "numeros[-1]"],
        correct: 1,
        explanation: "En Java los arreglos inician en √≠ndice 0. El primer elemento es numeros[0], que vale 10."
      },
      {
        question: "¬øC√≥mo se obtiene la cantidad de elementos de un arreglo llamado 'datos'?",
        options: ["datos.size()", "datos.length()", "datos.length", "datos.count()"],
        correct: 2,
        explanation: "La propiedad 'length' (sin par√©ntesis) devuelve el tama√±o de un arreglo: datos.length"
      },
      {
        question: "¬øQu√© valor tienen por defecto los elementos de un arreglo int[] reci√©n creado con 'new'?",
        code: "int[] arr = new int[4];",
        options: ["null", "1", "0", "undefined"],
        correct: 2,
        explanation: "Al crear un arreglo de enteros con 'new', todos sus elementos se inicializan autom√°ticamente en 0."
      },
      {
        question: "¬øCu√°l es el √≠ndice del √öLTIMO elemento de: int[] arr = new int[6]?",
        options: ["6", "5", "7", "4"],
        correct: 1,
        explanation: "Un arreglo de tama√±o 6 tiene √≠ndices del 0 al 5. El √∫ltimo elemento es arr[5]."
      },
      {
        question: "¬øC√≥mo se asigna el valor 99 al tercer elemento de un arreglo llamado 'notas'?",
        code: "int[] notas = new int[5];",
        options: ["notas.set(2, 99)", "notas[3] = 99", "notas[2] = 99", "notas.put(2, 99)"],
        correct: 2,
        explanation: "El tercer elemento est√° en √≠ndice 2 (0-basado). La sintaxis es notas[2] = 99;"
      },
      {
        question: "¬øCu√°l es el resultado de ejecutar este c√≥digo?",
        code: "int[] arr = {5, 10, 15};\nSystem.out.println(arr[1]);",
        options: ["5", "10", "15", "Error en tiempo de ejecuci√≥n"],
        correct: 1,
        explanation: "arr[0]=5, arr[1]=10, arr[2]=15. Al imprimir arr[1] se muestra 10."
      },

      // ---- ARREGLOS BIDIMENSIONALES ----
      {
        question: "¬øCu√°l es la forma correcta de declarar una matriz (arreglo bidimensional) de 3 filas y 4 columnas?",
        options: [
          "int matriz = new int[3][4];",
          "int[][] matriz = new int[3][4];",
          "int[3][4] matriz;",
          "int matriz[][] = int[3,4];"
        ],
        correct: 1,
        explanation: "La sintaxis correcta para una matriz en Java es: int[][] matriz = new int[filas][columnas];"
      },
      {
        question: "¬øC√≥mo se accede al elemento en la fila 1, columna 2 de una matriz llamada 'tabla'?",
        options: ["tabla[2][1]", "tabla(1,2)", "tabla[1][2]", "tabla.get(1,2)"],
        correct: 2,
        explanation: "Para acceder a un elemento en arreglos 2D se usa: tabla[fila][columna], es decir tabla[1][2]."
      },
      {
        question: "¬øCu√°ntos elementos en total tiene la siguiente matriz?",
        code: "int[][] m = new int[3][3];",
        options: ["3", "6", "9", "12"],
        correct: 2,
        explanation: "Una matriz de 3x3 tiene 3*3 = 9 elementos en total."
      },
      {
        question: "¬øCu√°l es el valor por defecto de cada celda en una matriz double[][] reci√©n creada?",
        code: "double[][] datos = new double[4][4];",
        options: ["null", "1.0", "0.0", "NaN"],
        correct: 2,
        explanation: "Las matrices de tipo double se inicializan con 0.0 al crearlas con 'new'."
      },

      // ---- CONSTRUCTOR CON PAR√ÅMETROS ----
      {
        question: "¬øCu√°l es la declaraci√≥n correcta de un constructor con par√°metros para la clase 'Alumno'?",
        code: "public class Alumno {\n    String nombre;\n    int edad;\n}",
        options: [
          "void Alumno(String n, int e) { }",
          "public Alumno(String n, int e) { nombre = n; edad = e; }",
          "Alumno constructor(String n, int e) { }",
          "public void Constructor(String n, int e) { }"
        ],
        correct: 1,
        explanation: "Un constructor con par√°metros tiene el mismo nombre que la clase, sin tipo de retorno, y recibe los valores para inicializar atributos."
      },
      {
        question: "¬øQu√© hace la palabra clave 'new' al llamar un constructor con par√°metros?",
        code: "Alumno a = new Alumno(\"Carlos\", 20);",
        options: [
          "Solo reserva memoria",
          "Solo llama al constructor",
          "Reserva memoria Y ejecuta el constructor con los par√°metros dados",
          "Crea una copia del objeto"
        ],
        correct: 2,
        explanation: "'new' hace dos cosas: asigna memoria en el heap para el nuevo objeto y luego ejecuta el constructor con los argumentos proporcionados."
      },
      {
        question: "¬øQu√© ocurre si una clase tiene constructor con par√°metros y se intenta usar 'new Clase()' sin argumentos?",
        code: "public class Producto {\n    public Producto(String nombre) { }\n}",
        options: [
          "Se crea el objeto con valores por defecto",
          "Error de compilaci√≥n: no existe constructor vac√≠o",
          "Se crea el objeto con null",
          "Java usa el constructor m√°s cercano"
        ],
        correct: 1,
        explanation: "Si solo defines un constructor con par√°metros, Java elimina el constructor vac√≠o por defecto. Llamar new Producto() genera error de compilaci√≥n."
      },

      // ---- M√âTODOS GET Y SET ----
      {
        question: "¬øCu√°l es la sintaxis correcta de un m√©todo GET para el atributo 'private int edad'?",
        options: [
          "void getEdad() { return edad; }",
          "public int getEdad() { return edad; }",
          "public getEdad() { return edad; }",
          "int get() { return edad; }"
        ],
        correct: 1,
        explanation: "Un getter es public, retorna el mismo tipo del atributo y su nombre comienza con 'get' seguido del atributo en CamelCase."
      },
      {
        question: "¬øCu√°l es la sintaxis correcta de un m√©todo SET para 'private String nombre'?",
        options: [
          "public String setNombre(String n) { nombre = n; }",
          "void setNombre() { }",
          "public void setNombre(String n) { nombre = n; }",
          "public setNombre(String n) { this.nombre = n; }"
        ],
        correct: 2,
        explanation: "Un setter es public, retorna void, recibe el nuevo valor como par√°metro y lo asigna al atributo privado."
      },
      {
        question: "¬øPara qu√© sirve declarar los atributos como 'private' si luego se crean getters y setters?",
        options: [
          "No tiene sentido, mejor declararlo public",
          "Para encapsular: controlar y validar el acceso a los datos desde fuera de la clase",
          "Solo es por convenci√≥n visual",
          "Para que los constructores funcionen"
        ],
        correct: 1,
        explanation: "La encapsulaci√≥n protege los datos internos. El setter puede incluir validaciones antes de asignar, lo que no es posible con atributos p√∫blicos directos."
      },

      // ---- FUNCIONES DE VALOR (return) ----
      {
        question: "¬øQu√© retorna el siguiente m√©todo?",
        code: "public int suma(int a, int b) {\n    return a + b;\n}",
        options: ["void", "Un String con la suma", "Un entero con la suma de a y b", "boolean"],
        correct: 2,
        explanation: "El m√©todo declara 'int' como tipo de retorno y devuelve 'a + b', que es la suma entera de los dos par√°metros."
      },
      {
        question: "¬øCu√°l es la diferencia entre un m√©todo void y una funci√≥n de valor en Java?",
        options: [
          "No hay diferencia",
          "void no devuelve nada; una funci√≥n de valor usa 'return' para devolver un resultado",
          "void es m√°s r√°pido",
          "Solo void puede tener par√°metros"
        ],
        correct: 1,
        explanation: "Los m√©todos void realizan acciones sin devolver resultado. Las funciones de valor tienen un tipo de retorno (int, String, etc.) y usan 'return' para entregar el resultado."
      },
      {
        question: "¬øQu√© imprime el siguiente c√≥digo?",
        code: "public int cuadrado(int n) {\n    return n * n;\n}\n// En main:\nSystem.out.println(cuadrado(4));",
        options: ["4", "8", "16", "Error"],
        correct: 2,
        explanation: "El m√©todo cuadrado(4) calcula 4 * 4 = 16 y lo devuelve. System.out.println imprime 16."
      }
    ];

    // CONFIG CARRERA
    const STEPS_TO_WIN = 10;
    const TRACK_LEFT = 10;
    const TRACK_RIGHT = 90;

    let gameState = {
      p1Score: 0,
      p2Score: 0,
      currentRound: 0,
      p1Answered: false,
      p2Answered: false,
      p1QuestionIndex: null,
      p2QuestionIndex: null,
      usedQuestions: [],
      ended: false
    };

    function initStepDots() {
      const dots = document.getElementById("step-dots");
      dots.innerHTML = "";
      for (let i = 0; i <= STEPS_TO_WIN; i++) {
        const d = document.createElement("div");
        d.className = "step-dot";
        dots.appendChild(d);
      }
    }

    function scoreToLeftPercent(score) {
      const s = Math.max(0, Math.min(STEPS_TO_WIN, score));
      const ratio = s / STEPS_TO_WIN;
      return TRACK_LEFT + (TRACK_RIGHT - TRACK_LEFT) * ratio;
    }

    function updateRunners() {
      const r1 = document.getElementById("runner1");
      const r2 = document.getElementById("runner2");
      r1.style.left = scoreToLeftPercent(gameState.p1Score) + "%";
      r2.style.left = scoreToLeftPercent(gameState.p2Score) + "%";
      document.getElementById("p1-steps").textContent = `P1 saltos: ${Math.min(gameState.p1Score, STEPS_TO_WIN)}/${STEPS_TO_WIN}`;
      document.getElementById("p2-steps").textContent = `P2 saltos: ${Math.min(gameState.p2Score, STEPS_TO_WIN)}/${STEPS_TO_WIN}`;
      const tieInfo = document.getElementById("tie-info");
      if (gameState.p1Score > gameState.p2Score) tieInfo.textContent = "Va ganando P1";
      else if (gameState.p2Score > gameState.p1Score) tieInfo.textContent = "Va ganando P2";
      else tieInfo.textContent = "Empate t√©cnico";
    }

    function animateJump(player) {
      const el = document.getElementById(player === 1 ? "runner1" : "runner2");
      el.classList.remove("jump");
      void el.offsetWidth;
      el.classList.add("jump");
    }

    function loadQuestion() {
      if (gameState.ended) return;
      if (gameState.p1Score >= STEPS_TO_WIN || gameState.p2Score >= STEPS_TO_WIN) {
        endGame(true);
        return;
      }
      if (gameState.currentRound >= questions.length) {
        endGame(false);
        return;
      }
      gameState.p1Answered = false;
      gameState.p2Answered = false;

      let q1Index, q2Index;
      do {
        q1Index = Math.floor(Math.random() * questions.length);
      } while (gameState.usedQuestions.includes(q1Index) && gameState.usedQuestions.length < questions.length);
      do {
        q2Index = Math.floor(Math.random() * questions.length);
      } while (
        q2Index === q1Index ||
        (gameState.usedQuestions.includes(q2Index) && gameState.usedQuestions.length < questions.length)
      );

      gameState.p1QuestionIndex = q1Index;
      gameState.p2QuestionIndex = q2Index;
      gameState.usedQuestions.push(q1Index, q2Index);

      loadPlayerQuestion(1, q1Index);
      loadPlayerQuestion(2, q2Index);
      document.getElementById("current-q").textContent = `Ronda: ${gameState.currentRound + 1}/10`;
    }

    function loadPlayerQuestion(player, questionIndex) {
      const q = questions[questionIndex];
      const panel = document.getElementById(`content${player}`);
      let html = `
        <div class="question-box">
          <div class="question-title">Pregunta ${gameState.currentRound + 1}</div>
          <div class="question-text">${q.question}</div>
          ${q.code ? `<div class="code-block"><pre>${q.code}</pre></div>` : ""}
          <div class="options" id="options${player}">
      `;
      q.options.forEach((option, index) => {
        html += `
          <button class="option-btn" onclick="selectOption(${player}, ${index})" id="btn-${player}-${index}">
            ${option}
          </button>
        `;
      });
      html += `
          </div>
          <div class="feedback" id="feedback${player}"></div>
        </div>
      `;
      panel.innerHTML = html;
    }

    function selectOption(player, index) {
      if (gameState.ended) return;
      if (player === 1 && gameState.p1Answered) return;
      if (player === 2 && gameState.p2Answered) return;

      const questionIndex = player === 1 ? gameState.p1QuestionIndex : gameState.p2QuestionIndex;
      const q = questions[questionIndex];
      const feedback = document.getElementById(`feedback${player}`);
      const buttons = document.querySelectorAll(`#options${player} .option-btn`);
      buttons.forEach(btn => (btn.disabled = true));

      if (player === 1) gameState.p1Answered = true;
      else gameState.p2Answered = true;

      if (index === q.correct) {
        if (player === 1) gameState.p1Score++;
        else gameState.p2Score++;
        document.getElementById("score" + player).textContent =
          (player === 1 ? gameState.p1Score : gameState.p2Score) + " Puntos";
        document.getElementById("p1-info").textContent = "P1: " + gameState.p1Score;
        document.getElementById("p2-info").textContent = "P2: " + gameState.p2Score;
        buttons[index].style.background = "#28a745";
        buttons[index].style.color = "white";
        feedback.classList.add("show", "correct");
        feedback.textContent = "‚úÖ ¬°Correcto! " + q.explanation;
        animateJump(player);
        updateRunners();
        if (gameState.p1Score >= STEPS_TO_WIN || gameState.p2Score >= STEPS_TO_WIN) {
          setTimeout(() => endGame(true), 700);
          return;
        }
      } else {
        buttons[index].style.background = "#f5c6cb";
        buttons[index].style.color = "#721c24";
        buttons[q.correct].style.background = "#28a745";
        buttons[q.correct].style.color = "white";
        feedback.classList.add("show", "incorrect");
        feedback.innerHTML = `‚ùå Incorrecto.<br><div class="correct-answer">Respuesta correcta: ${q.options[q.correct]}<br><br>${q.explanation}</div>`;
      }

      if (gameState.p1Answered && gameState.p2Answered) {
        setTimeout(() => {
          gameState.currentRound++;
          loadQuestion();
        }, 2500);
      }
    }

    function endGame(byRaceWin) {
      if (gameState.ended) return;
      gameState.ended = true;
      const gameOver = document.getElementById("gameOver");
      const winnerText = document.getElementById("winner-text");
      const finalScore = document.getElementById("final-score");
      const endMessage = document.getElementById("end-message");
      let emoji = "üèÜ";
      let winner = "";
      if (gameState.p1Score > gameState.p2Score) {
        winner = "üßë‚Äçüíª ¬°JUGADOR 1 GANA! üßë‚Äçüíª";
        emoji = "üéâ";
      } else if (gameState.p2Score > gameState.p1Score) {
        winner = "üßë‚Äçüíª ¬°JUGADOR 2 GANA! üßë‚Äçüíª";
        emoji = "üéâ";
      } else {
        winner = "ü§ù ¬°EMPATE! ü§ù";
        emoji = "‚öñÔ∏è";
      }
      document.getElementById("end-emoji").textContent = emoji;
      winnerText.textContent = winner;
      finalScore.textContent = `${gameState.p1Score} - ${gameState.p2Score}`;
      if (byRaceWin) {
        endMessage.textContent = "üèÅ ¬°Meta alcanzada! El primero en llegar a 10 saltos gana.";
      } else {
        endMessage.textContent = "¬°Excelente trabajo! Han demostrado dominio en Arreglos y POO Java.";
      }
      gameOver.style.display = "flex";
    }

    window.onload = () => {
      initStepDots();
      updateRunners();
      loadQuestion();
    };
  </script>
</body>
</html>
